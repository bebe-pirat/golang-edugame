<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—á–µ–Ω–∏–∫–∞</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar">
        <a href="/director" class="nav-brand">–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä</a>
        <div class="nav-links">
            <a href="/director"  class="logout-btn">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
            <a href="/logout" class="logout-btn">–í—ã–π—Ç–∏</a>
        </div>
    </nav>

    <div class="container">
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—á–µ–Ω–∏–∫–µ -->
        {{with .student_info}}
        <div class="student-header">
            <div class="student-info">
                <h1>{{.fullname}}</h1>
                <p>–£—á–µ–Ω–∏–∫ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞</p>
                
                <div class="student-meta">
                    <div class="meta-item">
                        <span>üë§</span>
                        <span>{{.username}}</span>
                    </div>
                    <div class="meta-item">
                        <span>üìÖ</span>
                        <span>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: {{.created_at}}</span>
                    </div>
                </div>
            </div>
        </div>
        {{end}}

        <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        {{with .overall}}
        <div class="overall-stats">
            <div class="overall-card attempts-stat">
                <div class="stat-icon">üìù</div>
                <div class="stat-value">{{.total_attempts}}</div>
                <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ø—ã—Ç–æ–∫</div>
            </div>
            
            <div class="overall-card correct-stat">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-value">{{.correct_attempts}}</div>
                <div class="stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
            </div>
            
            <div class="overall-card accuracy-stat">
                <div class="stat-icon">üéØ</div>
                <div class="stat-value">{{printf "%.1f" .accuracy}}%</div>
                <div class="stat-label">–û–±—â–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å</div>
            </div>
        </div>
        {{end}}

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º —É—Ä–∞–≤–Ω–µ–Ω–∏–π -->
        <div class="types-section">
            <h2 class="section-title">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º —É—Ä–∞–≤–Ω–µ–Ω–∏–π</h2>
            {{if .type_statistics}}
            <table class="types-table">
                <thead>
                    <tr>
                        <th>–¢–∏–ø —É—Ä–∞–≤–Ω–µ–Ω–∏—è</th>
                        <th>–ö–ª–∞—Å—Å</th>
                        <th>–ü–æ–ø—ã—Ç–æ–∫</th>
                        <th>–í–µ—Ä–Ω–æ</th>
                        <th>–¢–æ—á–Ω–æ—Å—Ç—å</th>
                        <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .type_statistics}}
                    <tr>
                        <td>{{.type_name}}</td>
                        <td>{{.class}}</td>
                        <td>{{.attempts}}</td>
                        <td>{{.correct}}</td>
                        <td class="progress-cell">
                            <div class="progress-container">
                                <div class="progress-text">
                                    {{printf "%.1f" .accuracy}}%
                                </div>
                            </div>
                        </td>
                        <td>{{.last_attempt}}</td>
                        <td>
                            {{if gt .attempts 0}}
                            <a href="/director/student/attempts?student_id={{$.student_info.id}}&type_id={{.type_id}}" 
                               class="type-link">
                                –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ø—ã—Ç–∫–∏
                            </a>
                            {{else}}
                            <span class="status-badge status-none">–ù–µ—Ç –ø–æ–ø—ã—Ç–æ–∫</span>
                            {{end}}
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
            {{else}}
            <p>
                –£—á–µ–Ω–∏–∫ –ø–æ–∫–∞ –Ω–µ —Ä–µ—à–∞–ª —É—Ä–∞–≤–Ω–µ–Ω–∏—è
            </p>
            {{end}}
        </div>

        <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏ -->
        {{if .recent_attempts}}
        <div class="attempts-section">
            <h2 class="section-title">‚è±Ô∏è –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏</h2>
            <div class="attempts-list">
                {{range .recent_attempts}}
                <div class="attempt-item {{if .is_correct}}correct{{else}}incorrect{{end}}">
                    <div class="attempt-header">
                        <div class="attempt-type">{{.type_name}}</div>
                        <div class="attempt-date">{{.created_at}}</div>
                    </div>
                    
                    <div class="attempt-equation">
                        {{.equation_text}}
                    </div>
                    
                    <div class="attempt-result {{if .is_correct}}correct-result{{else}}incorrect-result{{end}}">
                        {{if .is_correct}}
                        ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: {{.user_answer}}
                        {{else}}
                        ‚ùå –û—Ç–≤–µ—Ç: {{.user_answer}} (–≤–µ—Ä–Ω–æ: {{.correct_answer}})
                        {{end}}
                    </div>
                </div>
                {{end}}
            </div>
        </div>
        {{end}}
    </div>

    <script>

        // –ê–Ω–∏–º–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            const chartBars = document.querySelectorAll('.chart-bar');
            chartBars.forEach(bar => {
                const height = bar.style.height;
                bar.style.height = '0%';
                setTimeout(() => {
                    bar.style.height = height;
                }, 100);
            });
        });
    </script>
</body>
</html>