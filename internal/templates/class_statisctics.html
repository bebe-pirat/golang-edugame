<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∞—Å—Å–∞</title>
    
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar">
        <a href="/teacher/class" class="nav-brand">–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä</a>
        <div class="nav-links">
            <a href="/logout" class="logout-btn">–í—ã–π—Ç–∏</a>
        </div>
    </nav>

    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="header">
            <h1 class="page-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∞—Å—Å–∞</h1>
            <p class="page-subtitle">ID –∫–ª–∞—Å—Å–∞: {{.ClassID}}</p>
        </div>

        <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        {{with .Stats}}
        <div class="stats-grid">
            <div class="stat-card students-stat">
                <div class="stat-icon">üë•</div>
                <div class="stat-value">{{.student_count}}</div>
                <div class="stat-label">–£—á–µ–Ω–∏–∫–æ–≤ –≤ –∫–ª–∞—Å—Å–µ</div>
            </div>
            
            <div class="stat-card attempts-stat">
                <div class="stat-icon">üìù</div>
                <div class="stat-value">{{.total_attempts}}</div>
                <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ø—ã—Ç–æ–∫</div>
            </div>
            
            <div class="stat-card correct-stat">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-value">{{.correct_attempts}}</div>
                <div class="stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
            </div>
            
            <div class="stat-card accuracy-stat">
                <div class="stat-icon">üéØ</div>
                <div class="stat-value">{{printf "%.1f" .accuracy_percent}}%</div>
                <div class="stat-label">–û–±—â–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å</div>
            </div>
        </div>
        {{end}}

        <!-- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ 10 –ø—Ä–∏–º–µ—Ä–∞–º -->
        {{if .DailyResults}}
        <div class="daily-results">
            <h2 class="section-title">üìÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —É—á–µ–Ω–∏–∫–æ–≤ (–ø–æ 10 –ø—Ä–∏–º–µ—Ä–æ–≤)</h2>
            
            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º -->
            <div class="date-selector">
                <div class="date-range">
                    –ó–∞ –Ω–µ–¥–µ–ª—é: {{.DailyResults.WeekStart}} - {{.DailyResults.WeekEnd}}
                </div>
            </div>
            
            <!-- –õ–µ–≥–µ–Ω–¥–∞ -->
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #d4edda;"></div>
                    <span>10/10 (–û—Ç–ª–∏—á–Ω–æ)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #fff3cd;"></div>
                    <span>8-9/10 (–•–æ—Ä–æ—à–æ)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffeaa7;"></div>
                    <span>6-7/10 (–°—Ä–µ–¥–Ω–µ)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #f8d7da;"></div>
                    <span>0-5/10 (–°–ª–∞–±–æ)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #f8f9fa;"></div>
                    <span>–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</span>
                </div>
            </div>
            
            <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
            <div class="daily-results-table-container">
                <table class="daily-results-table">
                    <thead>
                        <tr>
                            <th class="student-name-col">–£—á–µ–Ω–∏–∫</th>
                            {{range .DailyResults.Dates}}
                            <th class="date-header">
                                {{.Weekday}}<br>
                                {{.Date}}
                            </th>
                            {{end}}
                            <th>–°—Ä–µ–¥–Ω–µ–µ</th>
                            <th>–í—Å–µ–≥–æ –ø–æ–ø—ã—Ç–æ–∫</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .DailyResults.Students}}
                        <tr>
                            <td class="student-name-col">
                                {{.FullName}}
                                {{if .IsActive}}
                                <span class="active-badge" style="color: green; font-size: 12px;">‚óè</span>
                                {{end}}
                            </td>
                            {{range .DailyResults}}
                            <td class="result-cell">
                                {{if .Results}}
                                <div class="multiple-results">
                                    {{range .Results}}
                                    <div class="result-item {{.CSSClass}}">
                                        {{.Correct}}/{{.Total}}
                                    </div>
                                    {{end}}
                                </div>
                                {{else}}
                                <div class="no-result">-</div>
                                {{end}}
                            </td>
                            {{end}}
                            <td>
                                {{if gt .AverageScore 0.0}}
                                <strong>{{printf "%.1f" .AverageScore}}/10</strong>
                                {{else}}
                                <div class="no-result">-</div>
                                {{end}}
                            </td>
                            <td>
                                <strong>{{.TotalAttempts}}</strong>
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            
            <!-- –°–≤–æ–¥–∫–∞ -->
            <div class="results-summary">
                <div class="summary-item">
                    <div class="summary-value">{{.DailyResults.Stats.AvgDailyAttempts}}</div>
                    <div class="summary-label">–°—Ä–µ–¥–Ω–µ–µ –ø–æ–ø—ã—Ç–æ–∫ –≤ –¥–µ–Ω—å</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value">{{printf "%.1f" .DailyResults.Stats.AvgScore}}/10</div>
                    <div class="summary-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value">{{.DailyResults.Stats.TotalSessions}}</div>
                    <div class="summary-label">–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value">{{.DailyResults.Stats.PerfectSessions}}</div>
                    <div class="summary-label">–ò–¥–µ–∞–ª—å–Ω—ã—Ö —Å–µ—Å—Å–∏–π</div>
                </div>
            </div>
        </div>
        {{end}}

        <!-- –¢–æ–ø —É—á–µ–Ω–∏–∫–æ–≤ -->
        {{if .Stats.top_students}}
        <div class="top-students">
            <h3>üèÜ –õ—É—á—à–∏–µ —É—á–µ–Ω–∏–∫–∏ –ø–æ —Ç–æ—á–Ω–æ—Å—Ç–∏</h3>
            <div class="top-list">
                {{range .Stats.top_students}}
                <div class="top-item">
                    <div class="top-rank">{{printf "%.1f" .accuracy}}%</div>
                    <div>{{.name}}</div>
                    <div>
                        {{.correct}}/{{.total}} –≤–µ—Ä–Ω–æ
                    </div>
                    <a href="/teacher/student?student_id={{.id}}" class="student-link">
                        –ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí
                    </a>
                </div>
                {{end}}
            </div>
        </div>
        {{end}}

        <!-- –£—á–µ–Ω–∏–∫–∏ –∫–ª–∞—Å—Å–∞ -->
        <div class="students-section">
            <h2 class="section-title">üë• –£—á–µ–Ω–∏–∫–∏ –∫–ª–∞—Å—Å–∞</h2>
            {{if .Students}}
            <table class="students-table">
                <thead>
                    <tr>
                        <th>–§–ò–û</th>
                        <th>–õ–æ–≥–∏–Ω</th>
                        <th>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .Students}}
                    <tr>
                        <td>{{.FullName}}</td>
                        <td>{{.Username}}</td>
                        <td>
                            <a href="/teacher/student?student_id={{.ID}}" class="student-link">
                                –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                            </a>
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
            {{else}}
            <p>
                –í –∫–ª–∞—Å—Å–µ –ø–æ–∫–∞ –Ω–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤
            </p>
            {{end}}
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º —É—Ä–∞–≤–Ω–µ–Ω–∏–π -->
        {{if .Stats.type_statistics}}
        <div class="types-section">
            <h2 class="section-title">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º —É—Ä–∞–≤–Ω–µ–Ω–∏–π</h2>
            <div class="types-grid">
                {{range .Stats.type_statistics}}
                <div class="type-card">
                    <div class="type-header">
                        <div class="type-name">{{.type_name}}</div>
                    </div>
                    
                    <div class="type-stats">
                        <div class="type-stat">
                            <div class="type-stat-value">{{.attempts}}</div>
                            <div class="type-stat-label">–ü–æ–ø—ã—Ç–æ–∫</div>
                        </div>
                        <div class="type-stat">
                            <div class="type-stat-value">{{.correct}}</div>
                            <div class="type-stat-label">–í–µ—Ä–Ω–æ</div>
                        </div>
                        <div class="type-stat">
                            <div class="type-stat-value">{{printf "%.1f" .accuracy}}%</div>
                            <div class="type-stat-label">–¢–æ—á–Ω–æ—Å—Ç—å</div>
                        </div>
                    </div>
                </div>
                {{end}}
            </div>
        </div>
        {{end}}
    </div>
</body>
</html>